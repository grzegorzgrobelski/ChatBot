<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <title>External Live Agent</title>
</head>
<body>
    <script type='text/javascript'>
        function initEmbeddedMessaging() {
            try {
                embeddedservice_bootstrap.settings.language = 'pl'; // For example, enter 'en' or 'en-US'

                embeddedservice_bootstrap.init(
                    '00D9O00000PCIdt',
                    'Demo_Embedded_GS1',
                    'https://foundationgs1poland2--newopptype.sandbox.my.site.com/ESWDemoEmbeddedGS11771865042666',
                    {
                        scrt2URL: 'https://foundationgs1poland2--newopptype.sandbox.my.salesforce-scrt.com'
                    }
                );
                addBlockEvent();
            } catch (err) {
                console.error('Error loading Embedded Messaging: ', err);
            }
        };

        function addBlockEvent() {
                window.addEventListener("message", (event) => {
                    //eventName: "onEmbeddedMessagingConversationParticipantChanged"
                    //entryType: 'ParticipantChanged', entryPayload: '{"entryType":"ParticipantChanged","id":"a332b37e-2â€¦"Michalina M"}],

                //console.log('Received message from iframe:', event.data);
                
                 if (
                    event.data.method === "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST" &&
                    event.data.data.eventDetails.conversationEntry &&
                    event.data.data.eventDetails.conversationEntry.entryPayload &&
                    event.data.data.eventDetails.conversationEntry.entryType === "ParticipantChanged" 
                ) {
                    console.log(event.data.data);
                    
                    //postIframeEnable();
                }
        






                //if (
                //    event.data.method === "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST" &&
                //   event.data.data.eventDetails.conversationEntry &&
                //    event.data.data.eventDetails.conversationEntry.entryPayload
                //) {
                //    let payload = JSON.parse(
                //        event.data.data.eventDetails.conversationEntry.entryPayload
                 //   );

                   // if (payload.abstractMessage && payload.abstractMessage.choices) {
                    //    postIframeDisable();
                    //} else if (payload.abstractMessage && payload.abstractMessage.choicesResponse) {
                        //console.log('payload.abstractMessage', payload.abstractMessage);
                        //console.log('payload.choicesResponse', payload.choicesResponse);
                    //    postIframeEnable();
                    //}
                //}


                
            });
        }

        function postIframeEnable() {
            var iframe = document.getElementById("embeddedMessagingFrame");
            iframe.contentWindow.postMessage('InputEnable', '*');
        }

        function postIframeDisable() {
            var iframe = document.getElementById("embeddedMessagingFrame");
            iframe.contentWindow.postMessage('InputDisable', '*');
        }

    </script>
    <script type='text/javascript' src='https://foundationgs1poland2--newopptype.sandbox.my.site.com/ESWDemoEmbeddedGS11771865042666/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
</body>
</html>