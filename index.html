<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>External Live Agent</title>
</head>
<body>
    <script type='text/javascript'>
	function initEmbeddedMessaging() {
            try {
                embeddedservice_bootstrap.settings.language = 'pl'; // For example, enter 'en' or 'en-US'

                embeddedservice_bootstrap.init(
                    '00D9O00000PCIdt',
                    'Demo_Embedded_GS1',
                    'https://foundationgs1poland2--newopptype.sandbox.my.site.com/ESWDemoEmbeddedGS11771865042666',
                    {
                        scrt2URL: 'https://foundationgs1poland2--newopptype.sandbox.my.salesforce-scrt.com'
                    }
                );
            } catch (err) {
                console.error('Error loading Embedded Messaging: ', err);
            }
        };
    </script>
    <script type='text/javascript' src='https://foundationgs1poland2--newopptype.sandbox.my.site.com/ESWDemoEmbeddedGS11771865042666/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>

    <script>
    // Event listener â€“ listens to every message/event from the iframe
    window.addEventListener("message", (event) => {
        if (
        event.data.method === "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST" &&
        event.data.data.eventDetails.conversationEntry &&
        event.data.data.eventDetails.conversationEntry.entryPayload
        ) {
        const payload = JSON.parse(
            event.data.data.eventDetails.conversationEntry.entryPayload
        );

        if (payload.abstractMessage && payload.abstractMessage.choices) {
            postIframeDisable();
        } else if (
            payload.abstractMessage &&
            payload.abstractMessage.choicesResponse
        ) {
            postIframeEnable();
        }
        }
    });

    // Post message to enable user input
    function postIframeEnable() {
        const iframe = document.getElementById("embeddedMessagingFrame");
        iframe.contentWindow.postMessage("InputEnable");
    }

    // Post message to disable user input
    function postIframeDisable() {
        const iframe = document.getElementById("embeddedMessagingFrame");
        iframe.contentWindow.postMessage("InputDisable");
    }
    </script>

</body>
</html>